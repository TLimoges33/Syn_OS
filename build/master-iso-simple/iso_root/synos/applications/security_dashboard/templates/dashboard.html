{% extends "base.html" %}

{% block title %}Security Dashboard - Syn_OS{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white">Security Dashboard</h1>
            <p class="text-slate-400 mt-1">Real-time monitoring of 10/10 security infrastructure</p>
        </div>
        <div class="flex items-center space-x-4">
            <div class="text-right">
                <div class="text-sm text-slate-400">Last Updated</div>
                <div id="lastUpdated" class="text-white font-medium">{{ security_metrics.last_updated or 'Never' }}</div>
            </div>
            <button onclick="refreshMetrics()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200">
                <i class="fas fa-sync-alt mr-2"></i>Refresh
            </button>
        </div>
    </div>

    <!-- Security Level Overview -->
    <div class="security-card p-6">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center">
                    <i class="fas fa-shield-alt text-2xl text-white"></i>
                </div>
                <div>
                    <h2 class="text-2xl font-bold text-white">Security Level: 10/10</h2>
                    <p class="text-green-400">All security systems operational</p>
                </div>
            </div>
            <div class="text-right">
                <div class="text-3xl font-bold text-green-400">100%</div>
                <div class="text-sm text-slate-400">System Integrity</div>
            </div>
        </div>
    </div>

    <!-- Core Security Components -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- HSM Status -->
        <div class="security-card p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-key text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">HSM</h3>
                        <p class="text-sm text-slate-400">Hardware Security</p>
                    </div>
                </div>
                <span class="status-indicator status-active"></span>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Key Operations</span>
                    <span class="text-white">{{ security_metrics.hsm_status.key_operations or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Secure Enclaves</span>
                    <span class="text-white">{{ security_metrics.hsm_status.secure_enclaves or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Tamper Events</span>
                    <span class="text-green-400">{{ security_metrics.hsm_status.tamper_events or 0 }}</span>
                </div>
            </div>
        </div>

        <!-- Zero Trust Status -->
        <div class="security-card p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-network-wired text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Zero Trust</h3>
                        <p class="text-sm text-slate-400">Network Security</p>
                    </div>
                </div>
                <span class="status-indicator status-active"></span>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Policies Enforced</span>
                    <span class="text-white">{{ security_metrics.zero_trust_status.policies_enforced or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Access Requests</span>
                    <span class="text-white">{{ security_metrics.zero_trust_status.access_requests or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Trust Score</span>
                    <span class="text-green-400">{{ security_metrics.zero_trust_status.trust_score or 0 }}/10</span>
                </div>
            </div>
        </div>

        <!-- Quantum Crypto Status -->
        <div class="security-card p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-atom text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Quantum Crypto</h3>
                        <p class="text-sm text-slate-400">Post-Quantum</p>
                    </div>
                </div>
                <span class="status-indicator status-active"></span>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Key Exchanges</span>
                    <span class="text-white">{{ security_metrics.quantum_crypto_status.key_exchanges or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Algorithms</span>
                    <span class="text-white">{{ security_metrics.quantum_crypto_status.algorithms|length or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Readiness</span>
                    <span class="text-green-400">{{ security_metrics.quantum_crypto_status.quantum_readiness or 'Unknown' }}</span>
                </div>
            </div>
        </div>

        <!-- Consciousness Security -->
        <div class="security-card p-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-pink-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-brain text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-semibold text-white">Consciousness</h3>
                        <p class="text-sm text-slate-400">AI Security</p>
                    </div>
                </div>
                <span class="status-indicator status-active pulse"></span>
            </div>
            <div class="space-y-2">
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Assessments</span>
                    <span class="text-white">{{ security_metrics.consciousness_security_status.autonomous_assessments or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Predictions</span>
                    <span class="text-white">{{ security_metrics.consciousness_security_status.threat_predictions or 0 }}</span>
                </div>
                <div class="flex justify-between text-sm">
                    <span class="text-slate-400">Consciousness Level</span>
                    <span class="text-purple-400">{{ "%.1f"|format(security_metrics.consciousness_security_status.consciousness_level or 0) }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Monitoring -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Active Threats -->
        <div class="security-card p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white">Active Threats</h3>
                <span class="bg-red-900 text-red-200 px-2 py-1 rounded text-sm">
                    {{ security_metrics.active_threats|length }} Active
                </span>
            </div>
            <div class="space-y-3">
                {% for threat in security_metrics.active_threats %}
                <div class="flex items-center justify-between p-3 bg-slate-700 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-red-600 rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation-triangle text-white text-sm"></i>
                        </div>
                        <div>
                            <div class="text-white font-medium">{{ threat.type|title }}</div>
                            <div class="text-sm text-slate-400">{{ threat.source_ip }}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm threat-level-{{ threat.severity }}">{{ threat.severity|upper }}</div>
                        <div class="text-xs text-slate-400">{{ threat.status|title }}</div>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-8 text-slate-400">
                    <i class="fas fa-shield-alt text-4xl mb-4 text-green-600"></i>
                    <p>No active threats detected</p>
                    <p class="text-sm">All systems secure</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Recent Security Events -->
        <div class="security-card p-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white">Recent Events</h3>
                <a href="/audit" class="text-blue-400 hover:text-blue-300 text-sm">View All</a>
            </div>
            <div class="space-y-3">
                {% for event in security_metrics.security_events %}
                <div class="flex items-center space-x-3 p-3 bg-slate-700 rounded-lg">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-info-circle text-white text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-white font-medium">{{ event.type|replace('_', ' ')|title }}</div>
                        <div class="text-sm text-slate-400">{{ event.user }} - {{ event.timestamp }}</div>
                    </div>
                    <div class="text-sm threat-level-{{ event.severity }}">{{ event.severity|upper }}</div>
                </div>
                {% else %}
                <div class="text-center py-8 text-slate-400">
                    <i class="fas fa-clipboard-list text-4xl mb-4"></i>
                    <p>No recent events</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- System Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Audit Summary -->
        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">24h Audit Summary</h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-slate-400">Total Events</span>
                    <span class="text-white font-medium">{{ security_metrics.audit_summary.total_events_24h or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">High Risk Events</span>
                    <span class="text-red-400 font-medium">{{ security_metrics.audit_summary.high_risk_events or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Auth Failures</span>
                    <span class="text-yellow-400 font-medium">{{ security_metrics.audit_summary.authentication_failures or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Successful Logins</span>
                    <span class="text-green-400 font-medium">{{ security_metrics.audit_summary.successful_logins or 0 }}</span>
                </div>
            </div>
        </div>

        <!-- API Activity -->
        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">API Activity</h3>
            <div class="space-y-3">
                <div class="flex justify-between">
                    <span class="text-slate-400">API Calls</span>
                    <span class="text-white font-medium">{{ security_metrics.audit_summary.api_calls or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Consciousness Ops</span>
                    <span class="text-purple-400 font-medium">{{ security_metrics.audit_summary.consciousness_operations or 0 }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Success Rate</span>
                    <span class="text-green-400 font-medium">98.7%</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-400">Avg Response</span>
                    <span class="text-blue-400 font-medium">45ms</span>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">Quick Actions</h3>
            <div class="space-y-3">
                <button onclick="runSecurityScan()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-search mr-2"></i>Run Security Scan
                </button>
                <button onclick="generateReport()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-file-alt mr-2"></i>Generate Report
                </button>
                <button onclick="consciousnessAssess()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-brain mr-2"></i>Consciousness Assess
                </button>
                <a href="/tools" class="block w-full bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg transition duration-200 text-sm text-center">
                    <i class="fas fa-tools mr-2"></i>Security Tools
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Dashboard-specific functions
function updateDashboardMetrics(metrics) {
    // Update last updated time
    const lastUpdated = document.getElementById('lastUpdated');
    if (lastUpdated && metrics.last_updated) {
        lastUpdated.textContent = new Date(metrics.last_updated).toLocaleString();
    }
    
    // Update security component statuses
    // This would update the various metrics displayed on the dashboard
}

async function refreshMetrics() {
    try {
        const response = await apiCall('/api/security/status');
        if (response.status === 'success') {
            updateDashboardMetrics(response.data);
            showNotification('Security metrics refreshed', 'success');
        }
    } catch (error) {
        console.error('Failed to refresh metrics:', error);
        showNotification('Failed to refresh metrics', 'error');
    }
}

async function runSecurityScan() {
    try {
        showNotification('Starting security scan...', 'info');
        
        // This would trigger a comprehensive security scan
        const response = await apiCall('/api/consciousness/security/assess', {
            method: 'POST',
            body: JSON.stringify({
                target: 'localhost',
                scan_type: 'comprehensive'
            })
        });
        
        if (response.status === 'success') {
            showNotification('Security scan completed', 'success');
        }
    } catch (error) {
        console.error('Security scan failed:', error);
        showNotification('Security scan failed', 'error');
    }
}

async function generateReport() {
    try {
        showNotification('Generating security report...', 'info');
        
        // This would generate a comprehensive security report
        const response = await apiCall('/api/security/audit/summary');
        
        if (response.status === 'success') {
            showNotification('Security report generated', 'success');
            // In a real implementation, this would download or display the report
        }
    } catch (error) {
        console.error('Report generation failed:', error);
        showNotification('Report generation failed', 'error');
    }
}

async function consciousnessAssess() {
    try {
        showNotification('Running consciousness security assessment...', 'info');
        
        const response = await apiCall('/api/consciousness/security/assess', {
            method: 'POST',
            body: JSON.stringify({
                target: 'system',
                assessment_type: 'full'
            })
        });
        
        if (response.status === 'success') {
            showNotification('Consciousness assessment completed', 'success');
            // Redirect to consciousness dashboard to view results
            setTimeout(() => {
                window.location.href = '/consciousness';
            }, 2000);
        }
    } catch (error) {
        console.error('Consciousness assessment failed:', error);
        showNotification('Consciousness assessment failed', 'error');
    }
}

// Auto-refresh dashboard every 30 seconds
setInterval(refreshMetrics, 30000);
</script>
{% endblock %}