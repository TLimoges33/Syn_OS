name: 🔄 Sync to Documentation Repository

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/PUBLIC_**'
      - 'README.md'
      - 'ARCHITECTURE.md'
  workflow_dispatch:
    inputs:
      sync_type:
        description: 'Type of sync to perform'
        required: true
        default: 'auto'
        type: choice
        options:
        - auto
        - manual
        - full

jobs:
  sync-to-docs:
    runs-on: ubuntu-latest
    name: 📚 Sync to SynapticOS-Docs
    
    steps:
    - name: 🔍 Checkout Dev Team Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 1
    
    - name: 🛠️ Setup Git
      run: |
        git config --global user.name "SynapticOS Sync Bot"
        git config --global user.email "sync-bot@synapticus.dev"
    
    - name: 📤 Trigger Documentation Repository Sync
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "🔄 Triggering documentation repository sync..."
        
        # Trigger the sync workflow in the documentation repository
        curl -X POST \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: token $GITHUB_TOKEN" \
          "https://api.github.com/repos/TLimoges33/SynapticOS-Docs/dispatches" \
          -d '{
            "event_type": "sync-docs",
            "client_payload": {
              "source_commit": "${{ github.sha }}",
              "source_ref": "${{ github.ref }}",
              "sync_type": "${{ github.event.inputs.sync_type || 'auto' }}"
            }
          }'
        
        echo "✅ Documentation sync triggered successfully!"
    
    - name: 📊 Summary
      run: |
        echo "📊 Sync Summary:"
        echo "==============="
        echo "✅ Source commit: ${{ github.sha }}"
        echo "🔄 Sync triggered for SynapticOS-Docs repository"
        echo "📚 Public documentation will be updated automatically"
        echo "🌐 Check: https://github.com/TLimoges33/SynapticOS-Docs"
