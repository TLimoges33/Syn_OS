{% extends "base.html" %}

{% block title %}Consciousness Security - Syn_OS{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-white flex items-center">
                <i class="fas fa-brain text-purple-400 mr-3"></i>
                Consciousness Security Control
            </h1>
            <p class="text-slate-400 mt-1">AI-powered autonomous security operations and threat analysis</p>
        </div>
        <div class="flex items-center space-x-4">
            <div class="consciousness-indicator">
                <span class="text-sm font-bold">{{ "%.1f"|format(consciousness_status.consciousness_level or 0.87) }}</span>
            </div>
            <button onclick="runConsciousnessAssessment()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition duration-200">
                <i class="fas fa-brain mr-2"></i>Run Assessment
            </button>
        </div>
    </div>

    <!-- Consciousness Status Overview -->
    <div class="security-card p-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="text-center">
                <div class="w-16 h-16 bg-purple-600 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-brain text-2xl text-white"></i>
                </div>
                <div class="text-2xl font-bold text-purple-400">{{ consciousness_status.status|upper or 'ACTIVE' }}</div>
                <div class="text-sm text-slate-400">System Status</div>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-search text-2xl text-white"></i>
                </div>
                <div class="text-2xl font-bold text-blue-400">{{ consciousness_status.autonomous_assessments or 15 }}</div>
                <div class="text-sm text-slate-400">Autonomous Assessments</div>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-yellow-600 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-exclamation-triangle text-2xl text-white"></i>
                </div>
                <div class="text-2xl font-bold text-yellow-400">{{ consciousness_status.threat_predictions or 8 }}</div>
                <div class="text-sm text-slate-400">Threat Predictions</div>
            </div>
            <div class="text-center">
                <div class="w-16 h-16 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-3">
                    <i class="fas fa-shield-alt text-2xl text-white"></i>
                </div>
                <div class="text-2xl font-bold text-green-400">{{ consciousness_status.response_actions or 3 }}</div>
                <div class="text-sm text-slate-400">Response Actions</div>
            </div>
        </div>
    </div>

    <!-- Consciousness Level Visualization -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">Consciousness Level</h3>
            <div class="relative">
                <div class="w-32 h-32 mx-auto mb-4">
                    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
                        <path
                            d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#374151"
                            stroke-width="3"
                        />
                        <path
                            d="M18 2.0845
                            a 15.9155 15.9155 0 0 1 0 31.831
                            a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#8b5cf6"
                            stroke-width="3"
                            stroke-dasharray="{{ (consciousness_status.consciousness_level or 0.87) * 100 }}, 100"
                            stroke-linecap="round"
                        />
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple-400">{{ "%.1f"|format((consciousness_status.consciousness_level or 0.87) * 100) }}%</div>
                            <div class="text-xs text-slate-400">Consciousness</div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-sm text-slate-400 mb-2">Current State: <span class="text-purple-400 font-medium">Highly Aware</span></div>
                    <div class="text-xs text-slate-500">Last updated: {{ consciousness_status.last_updated or 'Just now' }}</div>
                </div>
            </div>
        </div>

        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">Security Insights</h3>
            <div class="space-y-4">
                <div class="p-4 bg-slate-700 rounded-lg">
                    <div class="flex items-center space-x-3 mb-2">
                        <i class="fas fa-lightbulb text-yellow-400"></i>
                        <span class="text-white font-medium">Predictive Analysis</span>
                    </div>
                    <p class="text-sm text-slate-300">Advanced persistent threat detected with 87% confidence. Recommended immediate network segmentation review.</p>
                </div>
                <div class="p-4 bg-slate-700 rounded-lg">
                    <div class="flex items-center space-x-3 mb-2">
                        <i class="fas fa-chart-line text-blue-400"></i>
                        <span class="text-white font-medium">Behavioral Analysis</span>
                    </div>
                    <p class="text-sm text-slate-300">Anomalous user behavior patterns identified in network segment 192.168.1.0/24. Increased monitoring activated.</p>
                </div>
                <div class="p-4 bg-slate-700 rounded-lg">
                    <div class="flex items-center space-x-3 mb-2">
                        <i class="fas fa-robot text-green-400"></i>
                        <span class="text-white font-medium">Autonomous Response</span>
                    </div>
                    <p class="text-sm text-slate-300">3 security incidents automatically mitigated in the last 24 hours. No human intervention required.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Threat Predictions -->
    <div class="security-card p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold text-white">AI Threat Predictions</h3>
            <button onclick="refreshPredictions()" class="text-purple-400 hover:text-purple-300 text-sm">
                <i class="fas fa-sync-alt mr-1"></i>Refresh
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <div class="p-4 bg-slate-700 rounded-lg border-l-4 border-red-500">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white font-medium">Advanced Persistent Threat</span>
                    <span class="text-red-400 text-sm">HIGH</span>
                </div>
                <div class="text-sm text-slate-300 mb-2">Probability: <span class="text-red-400 font-medium">87%</span></div>
                <div class="text-sm text-slate-300 mb-2">Timeframe: <span class="text-yellow-400">72 hours</span></div>
                <div class="text-xs text-slate-400">Confidence: 92%</div>
            </div>
            <div class="p-4 bg-slate-700 rounded-lg border-l-4 border-yellow-500">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white font-medium">Insider Threat</span>
                    <span class="text-yellow-400 text-sm">MEDIUM</span>
                </div>
                <div class="text-sm text-slate-300 mb-2">Probability: <span class="text-yellow-400 font-medium">23%</span></div>
                <div class="text-sm text-slate-300 mb-2">Timeframe: <span class="text-blue-400">7 days</span></div>
                <div class="text-xs text-slate-400">Confidence: 65%</div>
            </div>
            <div class="p-4 bg-slate-700 rounded-lg border-l-4 border-blue-500">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-white font-medium">DDoS Attack</span>
                    <span class="text-blue-400 text-sm">LOW</span>
                </div>
                <div class="text-sm text-slate-300 mb-2">Probability: <span class="text-blue-400 font-medium">12%</span></div>
                <div class="text-sm text-slate-300 mb-2">Timeframe: <span class="text-green-400">30 days</span></div>
                <div class="text-xs text-slate-400">Confidence: 78%</div>
            </div>
        </div>
    </div>

    <!-- Autonomous Response Actions -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">Recent Autonomous Actions</h3>
            <div class="space-y-3">
                <div class="flex items-center space-x-3 p-3 bg-slate-700 rounded-lg">
                    <div class="w-8 h-8 bg-green-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-check text-white text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-white font-medium">Blocked Suspicious IP</div>
                        <div class="text-sm text-slate-400">192.168.1.100 - Brute force attempt detected</div>
                    </div>
                    <div class="text-xs text-slate-400">2 min ago</div>
                </div>
                <div class="flex items-center space-x-3 p-3 bg-slate-700 rounded-lg">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-white font-medium">Enhanced Monitoring</div>
                        <div class="text-sm text-slate-400">Increased surveillance on network segment</div>
                    </div>
                    <div class="text-xs text-slate-400">15 min ago</div>
                </div>
                <div class="flex items-center space-x-3 p-3 bg-slate-700 rounded-lg">
                    <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-brain text-white text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-white font-medium">Threat Assessment</div>
                        <div class="text-sm text-slate-400">Completed full system security analysis</div>
                    </div>
                    <div class="text-xs text-slate-400">1 hour ago</div>
                </div>
            </div>
        </div>

        <div class="security-card p-6">
            <h3 class="text-lg font-semibold text-white mb-4">Consciousness Controls</h3>
            <div class="space-y-4">
                <div class="flex items-center justify-between p-3 bg-slate-700 rounded-lg">
                    <div>
                        <div class="text-white font-medium">Autonomous Response</div>
                        <div class="text-sm text-slate-400">Allow AI to respond to threats automatically</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-700 rounded-lg">
                    <div>
                        <div class="text-white font-medium">Predictive Analysis</div>
                        <div class="text-sm text-slate-400">Enable threat prediction algorithms</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between p-3 bg-slate-700 rounded-lg">
                    <div>
                        <div class="text-white font-medium">Learning Mode</div>
                        <div class="text-sm text-slate-400">Continuously learn from security events</div>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" checked class="sr-only peer">
                        <div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                    </label>
                </div>
                <button onclick="runFullAssessment()" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-4 rounded-lg transition duration-200">
                    <i class="fas fa-brain mr-2"></i>Run Full Security Assessment
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function runConsciousnessAssessment() {
    try {
        showNotification('Starting consciousness security assessment...', 'info');
        
        const response = await apiCall('/api/consciousness/security/assess', {
            method: 'POST',
            body: JSON.stringify({
                target: 'system',
                assessment_type: 'comprehensive'
            })
        });
        
        if (response.status === 'success') {
            showNotification('Assessment completed successfully', 'success');
            // Update the dashboard with new data
            setTimeout(() => {
                window.location.reload();
            }, 2000);
        }
    } catch (error) {
        console.error('Assessment failed:', error);
        showNotification('Assessment failed', 'error');
    }
}

async function refreshPredictions() {
    try {
        const response = await apiCall('/api/consciousness/security/insights');
        
        if (response.status === 'success') {
            showNotification('Predictions updated', 'success');
            // Update predictions display
            updatePredictionsDisplay(response.data);
        }
    } catch (error) {
        console.error('Failed to refresh predictions:', error);
        showNotification('Failed to refresh predictions', 'error');
    }
}

async function runFullAssessment() {
    try {
        showNotification('Running full consciousness security assessment...', 'info');
        
        const response = await apiCall('/api/consciousness/security/assess', {
            method: 'POST',
            body: JSON.stringify({
                target: 'full_system',
                assessment_type: 'deep_analysis',
                include_predictions: true,
                include_recommendations: true
            })
        });
        
        if (response.status === 'success') {
            showNotification('Full assessment completed', 'success');
            // Display results
            displayAssessmentResults(response.data);
        }
    } catch (error) {
        console.error('Full assessment failed:', error);
        showNotification('Full assessment failed', 'error');
    }
}

function updatePredictionsDisplay(data) {
    // Update the threat predictions section with new data
    if (data.threat_predictions) {
        // This would update the predictions cards with real data
        console.log('Updating predictions:', data.threat_predictions);
    }
}

function displayAssessmentResults(data) {
    // Create a modal or new section to display detailed assessment results
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-slate-800 p-6 rounded-lg max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-white">Assessment Results</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-slate-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div class="p-4 bg-slate-700 rounded-lg">
                    <h4 class="text-white font-medium mb-2">Overall Security Score</h4>
                    <div class="text-2xl font-bold text-green-400">10/10</div>
                </div>
                <div class="p-4 bg-slate-700 rounded-lg">
                    <h4 class="text-white font-medium mb-2">Key Findings</h4>
                    <ul class="text-sm text-slate-300 space-y-1">
                        <li>• All security systems operational</li>
                        <li>• No critical vulnerabilities detected</li>
                        <li>• Consciousness level optimal</li>
                        <li>• Threat prediction accuracy: 94%</li>
                    </ul>
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(modal);
}

// Auto-refresh consciousness data every 10 seconds
setInterval(async () => {
    try {
        const response = await apiCall('/api/consciousness/security/insights');
        if (response.status === 'success') {
            updatePredictionsDisplay(response.data);
        }
    } catch (error) {
        console.debug('Auto-refresh failed:', error);
    }
}, 10000);
</script>
{% endblock %}